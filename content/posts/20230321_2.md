+++
title = "FlutterÃ—Firebase Crashlyticsã§éè‡´å‘½ï¼ˆnon-fatalï¼‰ã‚¨ãƒ©ãƒ¼ã‚’è¨˜éŒ²ã™ã‚‹"
date = "2023-03-21"
author = "orerus"
authorTwitter = "@orerus"
cover = "img/20230321_2/computer_sagi_error.png"
tags = ["Flutter", "ã‚¢ãƒ—ãƒªé–‹ç™º"]
keywords = ["Flutter", "Crashlytics"]
description = "éè‡´å‘½ï¼ˆnon-fatalï¼‰ã‚¨ãƒ©ãƒ¼ã‚’è¨˜éŒ²ã™ã‚‹è¨­å®šæ–¹æ³•"
showFullContent = false
readingTime = false
Toc = true
+++

## ã“ã®è¨˜äº‹ã¯ä½•ï¼Ÿ

Flutterã‚¢ãƒ—ãƒªã§ã®Firebase Crashlyticsã®è¨­å®šæ–¹æ³•ã¯[å…¬å¼ã‚µã‚¤ãƒˆ](https://firebase.google.com/docs/crashlytics/get-started?platform=flutter)ã‚„å…ˆé”ã®æ–¹ã®ç´ æ™´ã‚‰ã—ã„è¨˜äº‹ãŒéå¸¸ã«å‚è€ƒã«ãªã‚Šã¾ã—ãŸãŒã€å…¬å¼ã‚µã‚¤ãƒˆã‚’è¦‹ã¦ã‚‚éè‡´å‘½ï¼ˆnon-fatalï¼‰ã‚¨ãƒ©ãƒ¼ã«é–¢ã—ã¦ã®è¨˜è¿°ãŒåˆ†ã‹ã‚Šã¥ã‚‰ã‹ã£ãŸã®ã§ãƒ¡ãƒ¢ã—ã¦ãŠãã¾ã™ã€‚

## å›°ã£ãŸã“ã¨ï¼šéè‡´å‘½ï¼ˆnon-fatalï¼‰ã‚¨ãƒ©ãƒ¼ãŒè‡´å‘½ï¼ˆfatalï¼‰ã‚¨ãƒ©ãƒ¼ã¨ã—ã¦è¨˜éŒ²ã•ã‚Œã¦ã—ã¾ã†

å…¬å¼ã‚µã‚¤ãƒˆã® `Get Startd` ã®ãƒšãƒ¼ã‚¸ã«ã‚ã‚‹è¨˜è¿°é€šã‚Šã«è¨­å®šã™ã‚‹ã¨éè‡´å‘½ï¼ˆnon-fatalï¼‰ã‚¨ãƒ©ãƒ¼ã‚‚è‡´å‘½ï¼ˆfatalï¼‰ã‚¨ãƒ©ãƒ¼ã¨ã—ã¦è¨˜éŒ²ã•ã‚Œã¦ã—ã¾ã„ã¾ã—ãŸã€‚

ã‚ˆãè¦‹ã‚‹ã¨éè‡´å‘½ã‚¨ãƒ©ãƒ¼ã«é–¢ã—ã¦ã¯ [`Get Startd`](https://firebase.google.com/docs/crashlytics/get-started?platform=flutter) ã§ã¯ãªã [`Customize crash reports`](https://firebase.google.com/docs/crashlytics/customize-crash-reports?platform=flutter) ã®æ–¹ã«è¨˜è¼‰ãŒã‚ã£ãŸã®ã§ã™ãŒã€ã“ã¡ã‚‰ã‚’è¦‹ã¦ã‚‚éåŒæœŸã‚¨ãƒ©ãƒ¼ã®éè‡´å‘½ã‚¨ãƒ©ãƒ¼ã«ã¤ã„ã¦ã®è¨˜è¼‰ãŒãªãå›°ã£ã¦ã¾ã—ãŸã€‚

## è§£æ±ºæ–¹æ³•

ã¾ãšçµè«–ã‹ã‚‰è¨˜è¼‰ã—ã¦ãŠãã¨ã€ä»¥ä¸‹ã®ã‚ˆã†ã«è¨˜è¿°ã—ã¦ãŠã‘ã°è‡´å‘½ã‚¨ãƒ©ãƒ¼ã€éè‡´å‘½ã‚¨ãƒ©ãƒ¼ãŒãã¡ã‚“ã¨åˆ†ã‹ã‚Œã¦è¨˜éŒ²ã•ã‚Œã¾ã—ãŸã€‚

```dart
Future<void> main() async {
    WidgetsFlutterBinding.ensureInitialized();
    await Firebase.initializeApp(
        options: DefaultFirebaseOptions.currentPlatform,
    );
    FlutterError.onError = (errorDetails) {
      FirebaseCrashlytics.instance.recordFlutterError(errorDetails);
    };
    PlatformDispatcher.instance.onError = (error, stack) {
      FirebaseCrashlytics.instance.recordError(error, stack, fatal: false);
      return true;
    };
    runApp(MyApp());
}
```

â€»å®Ÿéš›ã«è¨­å®šã™ã‚‹éš›ã¯å¿…ãšæ„å›³é€šã‚Šã«å‹•ä½œã™ã‚‹ã‹ç¢ºèªãã ã•ã„

## è§£èª¬ã¨ã„ã†ã‹è£œè¶³

Crashlyticsä¸Šã§è¨˜éŒ²ã•ã‚Œã‚‹ã‚¨ãƒ©ãƒ¼ã«ã¯ä»¥ä¸‹ã®ï¼’ç¨®é¡ãŒã‚ã‚Šã¾ã™ã€‚(Androidã«ã¯ANRãŒã‚ã‚Šã¾ã™ãŒã“ã“ã§ã¯çœç•¥ã—ã¾ã™)

1. ã‚¯ãƒ©ãƒƒã‚·ãƒ¥ã‚’ä¼´ã†è‡´å‘½çš„ãªã‚¨ãƒ©ãƒ¼
2. ã‚¯ãƒ©ãƒƒã‚·ãƒ¥ã‚’ä¼´ã‚ãªã„éè‡´å‘½çš„ãªã‚¨ãƒ©ãƒ¼ï¼ˆè£œè¶³ã•ã‚Œãªã„ä¾‹å¤–ï¼‰

ã“ã‚Œã‚‰ã‚’Crashlyticsä¸Šã§åˆ†ã‘ã¦è¨˜éŒ²ã™ã‚‹ãŸã‚ã«ã¯ãã‚Œç”¨ã®è¨­å®šã‚’è¡Œã†å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

ã¾ãŸã€FlutterÃ—Firebase Crashlyticsã§ã¯åŒæœŸã‚¨ãƒ©ãƒ¼ã¨éåŒæœŸã‚¨ãƒ©ãƒ¼ã§è¨­å®šãŒï¼’ç®‡æ‰€ã«åˆ†ã‹ã‚Œã¾ã™ã€‚

### åŒæœŸã‚¨ãƒ©ãƒ¼ã®æ•æ‰

[å…¬å¼](https://firebase.google.com/docs/crashlytics/customize-crash-reports?platform=flutter#report-uncaught-exceptions)ã«ã‚ã‚‹ã‚ˆã†ã«ã€è‡´å‘½ã‚¨ãƒ©ãƒ¼ã‚’è£œè¶³ã™ã‚‹è¨­å®šã¯ä»¥ä¸‹ã«ãªã‚Šã¾ã™ã€‚ãªãŠã€è‡ªåˆ†ã®ç’°å¢ƒã§ã¯éè‡´å‘½ã‚¨ãƒ©ãƒ¼ã‚‚è‡´å‘½ã‚¨ãƒ©ãƒ¼ã¨ã—ã¦è¨˜éŒ²ã•ã‚Œã¾ã—ãŸã€‚

```dart
    FlutterError.onError = (errorDetails) {
      FirebaseCrashlytics.instance.recordFlutterFatalError(errorDetails);
    };
```

éè‡´å‘½ã‚¨ãƒ©ãƒ¼ `ã‚‚` æ•æ‰ã™ã‚‹ã«ã¯ä»¥ä¸‹ã®è¨˜è¿°ã«ç½®ãæ›ãˆã¾ã™ã€‚
ã“ã¡ã‚‰ã§è‡´å‘½ã€éè‡´å‘½ãŒåˆ†ã‹ã‚Œã¦è¨˜éŒ²ã•ã‚Œã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚

```dart
    FlutterError.onError = (errorDetails) {
      FirebaseCrashlytics.instance.recordFlutterError(errorDetails);
    };
```

### éåŒæœŸã‚¨ãƒ©ãƒ¼ã®æ•æ‰

[å…¬å¼](https://firebase.google.com/docs/crashlytics/customize-crash-reports?platform=flutter#report-uncaught-exceptions)ã«ã‚ã‚‹ã‚ˆã†ã«ã€éåŒæœŸã‚¨ãƒ©ãƒ¼ï¼ˆFlutterãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã§ã‚­ãƒ£ãƒƒãƒã•ã‚Œãªã„ã‚¨ãƒ©ãƒ¼ï¼‰ã‚’æ•æ‰ã™ã‚‹è¨­å®šã¯ä»¥ä¸‹ã«ãªã‚Šã¾ã™ã€‚
ãŸã ã—ã€ã“ã¡ã‚‰ã‚‚è‡ªåˆ†ã®ç’°å¢ƒã§ã¯éè‡´å‘½ã€è‡´å‘½å•ã‚ãšè‡´å‘½ã‚¨ãƒ©ãƒ¼ã¨ã—ã¦è¨˜éŒ²ã•ã‚Œã¾ã—ãŸã€‚

```dart
    PlatformDispatcher.instance.onError = (error, stack) {
      FirebaseCrashlytics.instance.recordError(error, stack, fatal: true);
      return true;
    };
```

ä»¥ä¸‹ã«å¤‰ãˆã‚‹ã¨ã€éåŒæœŸã‚¨ãƒ©ãƒ¼ã«ã¤ã„ã¦ã‚‚è‡´å‘½ã€éè‡´å‘½ãŒåˆ†ã‹ã‚Œã¦è¨˜éŒ²ã•ã‚Œã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚

```dart
    PlatformDispatcher.instance.onError = (error, stack) {
      FirebaseCrashlytics.instance.recordError(error, stack, fatal: false);
      return true;
    };
```

## ç¢ºèªç”¨Widgetã®ã‚µãƒ³ãƒ—ãƒ«

[å…ˆé”ã®æ–¹ã®è¨˜äº‹](https://qiita.com/kazutxt/items/a710115f9f9315002e90)ã‚’å‚è€ƒã«ã•ã›ã¦ã„ãŸã ãã€ãã¡ã‚‰ã«åŒæœŸ/éåŒæœŸã®è¦³ç‚¹ã‚’è¿½åŠ ã—ãŸã‚‚ã®ã«ãªã‚Šã¾ã™ã€‚

{{< image src="/img/20230321_2/Screenshot.png" alt="step1" position="center" style="border-radius: 8px;width: 300px;" >}}

```dart
class DebugCrashTest extends StatelessWidget {
  const DebugCrashTest({Key? key}) : super(key: key);

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      appBar: AppBar(
        title: Text("crash test"),
      ),
      body: Center(
        child: Column(
          mainAxisAlignment: MainAxisAlignment.center,
          children: <Widget>[
            // ä¾‹å¤–ã‚’ç™ºç”Ÿã•ã›ã‚‹ãƒœã‚¿ãƒ³ éåŒæœŸ
            ElevatedButton(
              onPressed: () async {
                FirebaseCrashlytics.instance.log('ExceptionLog async');
                throw Exception("MyException");
              },
              child: const Text('Throw Error async (non-fatal)'),
            ),
            // ä¾‹å¤–ã‚’ç™ºç”Ÿã•ã›ã‚‹ãƒœã‚¿ãƒ³ åŒæœŸ
            ElevatedButton(
              onPressed: () {
                FirebaseCrashlytics.instance.log('ExceptionLog sync');
                throw Exception("MyException");
              },
              child: const Text('Throw Error sync (non-fatal)'),
            ),
            // ã‚¢ãƒ—ãƒªã‚’ã‚¯ãƒ©ãƒƒã‚·ãƒ¥ã•ã›ã‚‹ãƒœã‚¿ãƒ³ éåŒæœŸ
            ElevatedButton(
              onPressed: () async {
                FirebaseCrashlytics.instance.log('CrashLog async');
                FirebaseCrashlytics.instance.crash();
              },
              child: const Text('Crash async (fatal)'),
            ),
            // ã‚¢ãƒ—ãƒªã‚’ã‚¯ãƒ©ãƒƒã‚·ãƒ¥ã•ã›ã‚‹ãƒœã‚¿ãƒ³ åŒæœŸ
            ElevatedButton(
              onPressed: () {
                FirebaseCrashlytics.instance.log('CrashLog sync');
                FirebaseCrashlytics.instance.crash();
              },
              child: const Text('Crash sync (fatal)'),
            ),
          ],
        ),
      ),
    );
  }
}
```

## ã•ã„ã”ã«

è¨˜äº‹ã«ä¸æ˜ç‚¹ã‚„èª¤ã‚Šãªã©ã‚ã‚Šã¾ã—ãŸã‚‰[Twitter](https://twitter.com/orerus)ã¾ã§DMã‚„ãƒªãƒ—ã‚’ãŠé¡˜ã„ã—ã¾ã™ğŸ™‡â€â™‚â€
