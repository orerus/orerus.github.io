<!doctype html><html lang=en><head><title>開発をお手伝いさせていただいたプロットマッピングカメラアプリ「CALINT」がリリースされました :: Orerus blog</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="CALINTとは CALINT（カリント）とは、株式会社moegiよりリリースされた、いわゆるプロットマッピングカメラアプリです。 ※現在はiO"><meta name=keywords content="CALINT"><meta name=robots content="noodp"><link rel=canonical href=https://orerus.github.io/posts/introduce_calint/><script async src="https://www.googletagmanager.com/gtag/js?id=G-PKF7KQEXQB"></script><script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','G-PKF7KQEXQB',{anonymize_ip:!1})}</script><link rel=stylesheet href=https://orerus.github.io/assets/style.css><link rel=apple-touch-icon href=https://orerus.github.io/img/apple-touch-icon-192x192.png><link rel="shortcut icon" href=https://orerus.github.io/img/favicon/orange.png><meta name=twitter:card content="summary"><meta name=twitter:site content="orerus"><meta name=twitter:creator content="orerus"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="og:title" content="開発をお手伝いさせていただいたプロットマッピングカメラアプリ「CALINT」がリリースされました"><meta property="og:description" content="CALINTとは CALINT（カリント）とは、株式会社moegiよりリリースされた、いわゆるプロットマッピングカメラアプリです。 ※現在はiO"><meta property="og:url" content="https://orerus.github.io/posts/introduce_calint/"><meta property="og:site_name" content="Orerus blog"><meta property="og:image" content="https://orerus.github.io/img/calint-logo-min.png"><meta property="og:image:width" content="2048"><meta property="og:image:height" content="1024"><meta property="article:published_time" content="2019-05-09 00:00:00 +0000 UTC"></head><body class=orange><div class="container headings--one-size"><header class=header><div class=header__inner><div class=header__logo><a href=/><div class=logo>Orerus blog</div></a></div><div class=menu-trigger>menu</div></div><nav class=menu><ul class="menu__inner menu__inner--desktop"><li><a href=/about>About</a></li></ul><ul class="menu__inner menu__inner--mobile"><li><a href=/about>About</a></li></ul></nav></header><div class=content><div class=post><h1 class=post-title><a href=https://orerus.github.io/posts/introduce_calint/>開発をお手伝いさせていただいたプロットマッピングカメラアプリ「CALINT」がリリースされました</a></h1><div class=post-meta><span class=post-date>2019-05-09</span>
<span class=post-author>:: orerus</span></div><span class=post-tags>#<a href=https://orerus.github.io/tags/%E3%82%A2%E3%83%97%E3%83%AA/>アプリ</a>&nbsp;</span>
<img src=https://orerus.github.io/img/calint-logo-min.png class=post-cover alt=開発をお手伝いさせていただいたプロットマッピングカメラアプリ「CALINT」がリリースされました title="Cover Image"><div class=post-content><div><h2 id=calintとは>CALINTとは<a href=#calintとは class=hanchor arialabel=Anchor>&#8983;</a></h2><p>CALINT（カリント）とは、株式会社moegiよりリリースされた、いわゆるプロットマッピングカメラアプリです。<br>※現在はiOSのみリリース済み</p><p>カメラで撮影を行いながら、同時に地図や速度、カメラの向きや標高などを記録できます。<br>具体的には、mp4、csv、gpxファイルを同時に記録できるアプリになります。</p><p>詳しくは、以下の公式サイト、および使用イメージを是非ご覧ください！</p><p>公式サイト: <a href=https://moegi.jp/calint/>CALINT</a></p><h2 id=使用イメージ>使用イメージ<a href=#使用イメージ class=hanchor arialabel=Anchor>&#8983;</a></h2><div style=position:relative;padding-bottom:56.25%;height:0;overflow:hidden><iframe src=https://www.youtube.com/embed/jFGsV8vfEAc style=position:absolute;top:0;left:0;width:100%;height:100%;border:0 allowfullscreen title="CALINT 紹介動画"></iframe></div><p>こちらの動画を見ていただければおおよそのアプリのイメージが掴んでいただけるかと思います！<br>ハイキングやドライブ、電車内・飛行機内からの撮影等、様々なシーンでご利用いただけるかと(^^)</p><h2 id=開発時の話>開発時の話<a href=#開発時の話 class=hanchor arialabel=Anchor>&#8983;</a></h2><p>諸事情により内部の作りの詳細についてはあまり記述できませんが、せっかくなので開発時の苦労話等を少しご紹介します</p><h3 id=アーキテクチャについて>アーキテクチャについて<a href=#アーキテクチャについて class=hanchor arialabel=Anchor>&#8983;</a></h3><p>今回は<a href=https://github.com/ReactorKit/ReactorKit>ReactorKit</a>を用いたFluxアーキテクチャを採用しました。</p><p>理由としては、アプリの特性上、様々なトリガー（ユーザーのタップや、GPSのコールバック、ファイル保存時のコールバック等）で処理が走る為、トリガーに関わらず処理のフローを一方向に限定し、各処理の記述位置を明確にしてコードをシンプルにし、バグを減らしたかった為です。<br>（ただでさえ録画周りで原因不明なクラッシュが発生しやすい・・・）</p><p>また、非同期での処理を前提とした構成にすることで、様々なトリガーによって処理が走った場合でも、自然とユーザー操作を邪魔しない（UIスレッドをブロックしない）作りにするという狙いもありました。</p><h3 id=iosでの録画について>iOSでの録画について<a href=#iosでの録画について class=hanchor arialabel=Anchor>&#8983;</a></h3><p>iOSでのカメラを用いた録画方法については、Qiita等にいくつかの良質な記事が挙がっています。</p><p>ただし、今回の要件として、カメラに映った映像をそのまま録画するのではなく、画面上に表示している地図や速度計等のViewも同時に記録する必要がありました。</p><p>その場合、以下の２通りの録画方法を検討しました。</p><ol><li>カメラでキャプチャした映像にViewを合成し記録する</li><li>デバイスに表示されているViewを丸ごと記録する</li></ol><h4 id=1-カメラでキャプチャした映像にviewを合成し記録する>1. カメラでキャプチャした映像にViewを合成し記録する<a href=#1-カメラでキャプチャした映像にviewを合成し記録する class=hanchor arialabel=Anchor>&#8983;</a></h4><p>こちらの方法についてまず試したところ、合成すべきViewの内容（地図や速度）が常に変化するものである為、毎フレーム合成し直す必要があり、処理が１フレームの時間内に収まらず、録画ファイルが明らかにコマ落ちしているような品質になってしまい、断念しました。<br>ただし、こちらの方法ではiOSが備えているカメラの手ぶれ補正機能を使えるという大きなメリットがある為、撮影内容のクオリティを求める場合はこちらの方法をお勧めします。</p><h4 id=2-デバイスに表示されているviewを丸ごと記録する>2. デバイスに表示されているViewを丸ごと記録する<a href=#2-デバイスに表示されているviewを丸ごと記録する class=hanchor arialabel=Anchor>&#8983;</a></h4><p>こちらは、iOS11から搭載されたスクリーンレコーディングとほぼ同じイメージです。（<a href=https://gori.me/ios/ios11/96712>参考記事</a>）</p><p>そして、嬉しいことに単純に撮影するだけであれば、<a href=https://developer.apple.com/documentation/replaykit>ReplayKit</a>という上記のスクリーンレコーディングがアプリ内からできるツールが標準で用意されています。 （<a href=https://qiita.com/akira108/items/babf68a3e7b37f3ca379>参考記事</a>）</p><p>ただし、上記参考記事のようなシンプルな使い方を行った場合、撮影終了時に <code>RPPreviewController</code> を呼び出してユーザーに保存またはシェアさせる、といったフローになる（プログラム側で勝手に保存できない）為、ReplayKitで撮影し渡されたbufferを <code>AVAssetWriter</code> を用いて毎フレーム記録する、という方法を取っています。</p><h3 id=replaykitを使った撮影>ReplayKitを使った撮影<a href=#replaykitを使った撮影 class=hanchor arialabel=Anchor>&#8983;</a></h3><p>これが、様々な要因でクラッシュします・・・<br>また、クラッシュした際に出てくるメッセージが <code>Error Domain=com.apple.ReplayKit.RPRecordingErrorDomain Code=-5807 "Recording interrupted by multitasking and content resizing"</code> といったよく分からないものばかりです。<br>エラーコードっぽいものが出てますが、このコードの詳細についてはAppleのドキュメントに一切記載が無い為、非常に苦労しました・・・</p><h3 id=iosシミュレータが使えない>iOSシミュレータが使えない<a href=#iosシミュレータが使えない class=hanchor arialabel=Anchor>&#8983;</a></h3><p>カメラ機能をフルに使ったアプリである為、シミュレータでの開発がほぼできず、 iPhone X 等の対応を実機でやらざるを得ず、こちらもまた苦労しました・・・</p><h2 id=さいごに>さいごに<a href=#さいごに class=hanchor arialabel=Anchor>&#8983;</a></h2><p>とりとめのない紹介になってしまいましたが、アプリ内容や開発話等、何かありましたらTwitter等で気軽に呼びかけていただければと思います！</p></div></div></div></div><footer class=footer><div class=footer__inner><div class=copyright><span>© 2021 Powered by <a href=http://gohugo.io>Hugo</a></span>
<span>:: Theme made by <a href=https://twitter.com/panr>panr</a></span></div></div></footer><script src=https://orerus.github.io/assets/main.js></script><script src=https://orerus.github.io/assets/prism.js></script></div></body></html>