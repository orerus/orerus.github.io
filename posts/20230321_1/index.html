<!doctype html><html lang=en><head><title>Flutterでbuildを繰り返していると「File name too long」と出る問題 :: Orerus blog</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="flutterでbuildを繰り返していると「File name too long」と出る問題の対応"><meta name=keywords content="Flutter"><meta name=robots content="noodp"><link rel=canonical href=https://orerus.github.io/posts/20230321_1/><script async src="https://www.googletagmanager.com/gtag/js?id=G-PKF7KQEXQB"></script><script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','G-PKF7KQEXQB',{anonymize_ip:!1})}</script><link rel=stylesheet href=https://orerus.github.io/assets/style.css><link rel=apple-touch-icon href=https://orerus.github.io/img/apple-touch-icon-192x192.png><link rel="shortcut icon" href=https://orerus.github.io/img/ahiru.svg><meta name=twitter:card content="summary"><meta name=twitter:site content="@orerus"><meta name=twitter:creator content="@orerus"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="og:title" content="Flutterでbuildを繰り返していると「File name too long」と出る問題"><meta property="og:description" content="flutterでbuildを繰り返していると「File name too long」と出る問題の対応"><meta property="og:url" content="https://orerus.github.io/posts/20230321_1/"><meta property="og:site_name" content="Orerus blog"><meta property="og:image" content="https://orerus.github.io/img/20230321_1/character_program_shock.png"><meta property="og:image:width" content="2048"><meta property="og:image:height" content="1024"><meta property="article:published_time" content="2023-03-21 00:00:00 +0000 UTC"></head><body class=orange><div class="container headings--one-size"><header class=header><div class=header__inner><div class=header__logo><a href=/><div class=logo>Orerus blog</div></a></div><div class=menu-trigger>menu</div></div><nav class=menu><ul class="menu__inner menu__inner--desktop"><li><a href=/about>About</a></li></ul><ul class="menu__inner menu__inner--mobile"><li><a href=/about>About</a></li></ul></nav></header><div class=content><div class=post><h1 class=post-title><a href=https://orerus.github.io/posts/20230321_1/>Flutterでbuildを繰り返していると「File name too long」と出る問題</a></h1><div class=post-meta><span class=post-date>2023-03-21</span>
<span class=post-author>:: orerus</span></div><span class=post-tags>#<a href=https://orerus.github.io/tags/flutter/>Flutter</a>&nbsp;
#<a href=https://orerus.github.io/tags/%E3%82%A2%E3%83%97%E3%83%AA%E9%96%8B%E7%99%BA/>アプリ開発</a>&nbsp;</span>
<img src=https://orerus.github.io/img/20230321_1/character_program_shock.png class=post-cover alt="Flutterでbuildを繰り返していると「File name too long」と出る問題" title="Cover Image"><div class=table-of-contents><h2>目次</h2><nav id=TableOfContents><ul><li><a href=#flutterでandroidアプリを繰り返しrunしていると突然コケることがある>FlutterでAndroidアプリを繰り返しrunしていると突然コケることがある</a></li><li><a href=#原因>原因</a></li><li><a href=#とりあえずの対応策>とりあえずの対応策</a><ul><li><a href=#一応androidstudioの設定手順も>一応AndroidStudioの設定手順も</a></li></ul></li><li><a href=#さいごに>さいごに</a></li></ul></nav></div><div class=post-content><div><h2 id=flutterでandroidアプリを繰り返しrunしていると突然コケることがある>FlutterでAndroidアプリを繰り返しrunしていると突然コケることがある<a href=#flutterでandroidアプリを繰り返しrunしていると突然コケることがある class=hanchor arialabel=Anchor>&#8983;</a></h2><p>こんな感じで、突如 <code>File name too long</code> を吐き出して以降コケ続けることがあります。</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>* What went wrong:
Execution failed for task &#39;:app:copyFlutterAssetsLocalDebug&#39;.
&gt; Could not copy file &#39;/hoge/fuga/…/android/app/build/intermediates/flutter/{variant}/flutter_assets/android/app/build/intermediates/merged_assets/{variant}/out/flutter_assets/android/app/build/intermediates/merged_assets/…/piyo&#39; to &#39;/hoge/fuga/…/android/app/build/intermediates/flutter/{variant}/flutter_assets/android/app/build/intermediates/merged_assets/{variant}/out/flutter_assets/android/app/build/intermediates/merged_assets/…/piyo&#39;.
   &gt; /hoge/fuga/…/android/app/build/intermediates/flutter/{variant}/flutter_assets/android/app/build/intermediates/merged_assets/{variant}/out/flutter_assets/android/app/build/intermediates/merged_assets/…/piyo (File name too long)

* Try:
Run with --stacktrace option to get the stack trace. Run with --info or --debug option to get more log output. Run with --scan to get full insights.

* Get more help at https://help.gradle.org

BUILD FAILED in 1m 48s
Exception: Gradle task assembleLocalDebug failed with exit code 1
</code></pre></div><p>手元の環境では <a href=https://chromium.googlesource.com/external/github.com/flutter/flutter/+/refs/tags/v1.12.10/packages/flutter_tools/gradle/flutter.gradle#652>gradle の copyFlutterAssetsTask</a> のタイミングでコケていました。</p><h2 id=原因>原因<a href=#原因 class=hanchor arialabel=Anchor>&#8983;</a></h2><p>よくわかりません🙏<br>ただ、下記ツイートにあるようにbuild回数を重ねる事にbuildディレクトリが深くなっていっているので、buildの都度ディレクトリが掘られる -> file name too long の流れっぽいことは確かだと思われます。</p><blockquote class=twitter-tweet><p lang=ja dir=ltr>cache削除してやり直した1回目と2回目の結果がこちら。flutter_assets/android 配下がループしてるっぽいけど原因を追う気力が出ぬ <a href=https://t.co/VgVHhMJ7dL>pic.twitter.com/VgVHhMJ7dL</a></p>&mdash; スク (@orerus) <a href="https://twitter.com/orerus/status/1637115808890621952?ref_src=twsrc%5Etfw">March 18, 2023</a></blockquote><script async src=https://platform.twitter.com/widgets.js></script><h2 id=とりあえずの対応策>とりあえずの対応策<a href=#とりあえずの対応策 class=hanchor arialabel=Anchor>&#8983;</a></h2><p>根本原因は分からないので場当たり的な方法になりますが、手っ取り早くやるなら下記コマンドでbuildディレクトリを削除して再度runすればOK。</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>rm -rf android/app/build
</code></pre></div><p>自分は都度コマンドを叩くのが面倒だった為、AndroidStudioの機能を使って以下のようなシェルスクリプトをbuildの前に実行するようにして凌いでいます。</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#75715e>#!/bin/bash
</span><span style=color:#75715e></span>
DIR<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;android/app/build/intermediates/flutter/{variant}/flutter_assets/android&#34;</span>

<span style=color:#66d9ef>if</span> <span style=color:#f92672>[</span> -d <span style=color:#e6db74>&#34;</span>$DIR<span style=color:#e6db74>&#34;</span> <span style=color:#f92672>]</span>; <span style=color:#66d9ef>then</span>
  rm -rf <span style=color:#e6db74>&#34;</span>$DIR<span style=color:#e6db74>&#34;</span>
<span style=color:#66d9ef>fi</span>

DIR<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;android/app/build/intermediates/merged_assets/{variant}/out/flutter_assets/android&#34;</span>

<span style=color:#66d9ef>if</span> <span style=color:#f92672>[</span> -d <span style=color:#e6db74>&#34;</span>$DIR<span style=color:#e6db74>&#34;</span> <span style=color:#f92672>]</span>; <span style=color:#66d9ef>then</span>
  rm -rf <span style=color:#e6db74>&#34;</span>$DIR<span style=color:#e6db74>&#34;</span>
<span style=color:#66d9ef>fi</span>
</code></pre></div><p>※{variant}の部分は各自の環境に読み替えてください<br>※とりあえず上の２つのディレクトリを消しておけば大丈夫そうでした</p><h3 id=一応androidstudioの設定手順も>一応AndroidStudioの設定手順も<a href=#一応androidstudioの設定手順も class=hanchor arialabel=Anchor>&#8983;</a></h3><table><tr><td><img src=/img/20230321_1/remove_build_1.png alt=step1 class=center style=border-radius:8px></td></tr><tr><td><img src=/img/20230321_1/remove_build_2.png alt=step2 class=center style=border-radius:8px></td></tr><tr><td><img src=/img/20230321_1/remove_build_3.png alt=step3 class=center style=border-radius:8px></td></tr></table><h2 id=さいごに>さいごに<a href=#さいごに class=hanchor arialabel=Anchor>&#8983;</a></h2><p>もし根本原因＆解決策がお分かりの方いらっしゃいましたら是非<a href="https://twitter.com/orerus/status/1637114770691346434?s=20">Twitter</a>の方にDMかリプください🙇‍♂‍</p></div></div><div class=pagination><div class=pagination__title><span class=pagination__title-h>Read other posts</span><hr></div><div class=pagination__buttons><span class="button previous"><a href=https://orerus.github.io/posts/20230321_2/><span class=button__icon>←</span>
<span class=button__text>Flutter×Firebase Crashlyticsで非致命（non-fatal）エラーを記録する</span></a></span>
<span class="button next"><a href=https://orerus.github.io/posts/introduce_calint/><span class=button__text>開発をお手伝いさせていただいたプロットマッピングカメラアプリ「CALINT」がリリースされました</span>
<span class=button__icon>→</span></a></span></div></div></div></div><footer class=footer><div class=footer__inner><div class=copyright><span>© 2024 Powered by <a href=http://gohugo.io>Hugo</a></span>
<span>:: Theme made by <a href=https://twitter.com/panr>panr</a></span></div></div></footer><script src=https://orerus.github.io/assets/main.js></script><script src=https://orerus.github.io/assets/prism.js></script></div></body></html>